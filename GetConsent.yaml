openapi: 3.0.3
info:
  title: Get Consent

  description: |
    Contains all needed operations for handling different types of consents.
    The covered types are
    - consent for digital storage and processing of data
    - consent for usage of personal data for marketin
    - consent for digital communication

     Contributors:
      - Stefan Schuster
      - Ingo KÃ¼sters
      - Ozan-Hakki Aksoy
      - Barnabas Takacs
      - Dron Puri
      - Luca Debernari
      - Mauro Galli
      - Annegret Junker

  version: 0.9.0
  contact:
    email: ingo.kuesters@allianz.de
servers:
  - url: 'https://www.allianz.com/apis/consentmanagement'
tags:
  - name: Data Processing Consent
    description: A consent given by a person that her or his data can be processes by the company given the consent to
  - name: Data Processing Consent Revocation
    description: A request to revoke a consent given by certain person.
  - name: Data Processing Consent Terms and Conditions
    description: Terms and Condition for Data Processing Consent
  - name: Marketing Consent
    description: A consent given by a person that allows a compoany to send to her or him marketing material.
  - name: Marketing Consent Revocation
    description: A request to revoke a consent given by certain person.
  - name: Marketing Consent Terms and Conditions
    description: Terms and Condition for Marketing Consent
  - name: Digital Communication Consent
    description: A consent given by person which allows  a company to reach out to her or him via e-mail rather than mail.
  - name: Digital Communication Consent Revocation
    description: A request to revoke a consent given by certain person.
  - name: Digital Communication Consent Terms and Conditions
    description: Terms and Condition for Digital Communication Consent

paths:

  /dataprocessingconsent:
    post:
      summary: Create a new data processing consent
      tags:
        - Data Processing Consent
      description: |
        A new consent to allow storage and process personal data is created.

        - The consent giving person has to be identified upfront and must be refereced by its personId.
        - The version of the data consent has to be provided to make sure that the current terms and conditions
          are displayed to the consent giving person. It can be derived when getting the terms and conditions via
          'get /dataProcessingConsentTermsAndConditions'

        **Assumption, to be clarified:** *confirmed from Italy, confirmation from Germany pending*

        The permission to transfer the data for storing and processing to 3rd parties will be given on person level
        and will be valid for all contracts of that person. If that permission has to be on contract level, we will
        remove the attribute externalUsageAllowed and create new endpoints for 'dataProcessingConsentExternalUse'
        with policyId instead of personId as input parameter.

      operationId: createDataProcessingConsent 
      security:
        - OAuth2:
          - write
      requestBody:
        $ref: '#/components/requestBodies/DataProcessingConsentRequestBody'
      responses:
        '201':
          description: Data processing consent successfully created
          content:
            application/json:
              schema:
                  $ref: '#/components/schemas/DataProcessingConsent'
        '400':
          description: Bad request. Usually returned if a required input parameter is missing.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '../Error/ErrorCatalog.yaml/#/components/schemas/Error'
        '403':
          description: Forbidden. No further information for security errors.
        '412':
          description: |
            Precondition Failed. Ususally thrown if an outdated version of the terms and conditions is used
            or the given personId is not valid.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '../Error/ErrorCatalog.yaml/#/components/schemas/Error'


  /dataprocessingconsent/{consentid}:
    get:
      summary: Get details for a data processing consent identified by its consentId
      tags:
        - Data Processing Consent
      description: |
        Delivers detailed information about a consent to store and process personal data identified by the consentId.
      operationId: getDataProcessingConsentById
      security:
        - OAuth2:
            - read
      parameters:
        - name: consentid
          description: The id of the consent which shall be returned
          in: path
          required: true
          schema:
            type: string
            format: uuid
            example: 0e62c4b9-34bd-422c-8a6c-40f16c451214
      responses:
        '200':
          description: Detailed information about a data processing consent
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DataProcessingConsent'
        '400':
          description: Bad request. Usually returned if a required input parameter is missing.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '../Error/ErrorCatalog.yaml/#/components/schemas/Error'
        '403':
          description: Forbidden. No further information for security errors.
        '404':
          description: No consent found for this consent ID
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '../Error/ErrorCatalog.yaml/#/components/schemas/Error'

  /dataprocessingconsentlist:
    get:
      summary: Get a list of data processing consents of a specific person
      tags:
        - Data Processing Consent
      description: |
        Delivers a list of consents to store and process personal data for a specific person idientified by
        its personId with detailed information about the consents.

        The list can be filtered by the consent status, if no status is given all consents independend if its status
        will be returned.
      operationId: getDataProcessingConsentListByPersonAndStatus
      security:
          - OAuth2:
            - read
      parameters:
        - name: personId
          in: query
          description: PersonId as UUID of the person who has given the consent
          required: true
          schema:
            type: string
            format: uuid
            example: eb0ddaab-56ff-4cbd-8589-1f2fe219ffdf
        - name: consentStatus
          in: query
          description: Optional state of the consent to filter the list, e.g. receive only consents with state confirmed
          required: false
          schema:
            $ref: '#/components/schemas/ConsentStatus'
      responses:
        '200':
          description: List of data processing consents for a person
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/DataProcessingConsent'
        '403':
          description: Forbidden. No further information for security errors.
        '404':
          description: No consent found for this person ID
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '../Error/ErrorCatalog.yaml/#/components/schemas/Error'


  /checkdataprocessingconsent:
    get:
      summary: Check if a specific person has given a valid consent for storing and processing its personal data
      tags:
        - Data Processing Consent
      description: |
        Checks if a specific person identified by its personId has given a valid consent for storing and
        processing its personal data and returns the id of the latest valid consent (if given).
      operationId: checkOnDataProcessingConsentByPerson
      security:
        - OAuth2:
            - read
      parameters:
        - name: personId
          in: query
          description: PersonId as UUID who has given the consent
          required: true
          schema:
            type: string
            format: uuid
            example: eb0ddaab-56ff-4cbd-8589-1f2fe219ffdf
      responses:
        '200':
          description: Data processing consent given
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DataProcessingConsentGiven'
        '403':
          description: Forbidden. No further information for security errors.
        '404':
          description: No person found for this person ID
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '../Error/ErrorCatalog.yaml/#/components/schemas/Error'

  /dataprocessingconsentrevocationrequest:
    post:
      summary: Start a process to revoke a data processing consent identified by its id
      tags:
        - Data Processing Consent Revocation
      description: Starts a process to revoke a consent to store and process personal data identified by its id.<br>The scope of the revocation can be limited to external usage, so Allianz may still store and process personal data but must not transfer it to 3rd parties.
      operationId: revokeDataProcessingConsentById
      security:
        - OAuth2:
            - write
      requestBody:
        $ref: '#/components/requestBodies/DataProcessingRevocationRequestBody'
      responses:
        '200':
          description: process of revoking a given data processing consent was started
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DataProcessingConsentRevocationResponse'
        '400':
          description: Bad request. Usually returned if a required input parameter is missing.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '../Error/ErrorCatalog.yaml/#/components/schemas/Error'
        '403':
          description: Forbidden. No further information for security errors.
        '404':
          description: No consent found for this consent ID
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '../Error/ErrorCatalog.yaml/#/components/schemas/Error'


  /dataprocessingconsentrevocationrequest/{revocationprocessid}:
    get:
      summary: Get the status of a data consent revocation process
      tags:
        - Data Processing Consent Revocation
      description: |
        Get detailed information including the status of a data consent revocation process identified by
        its revocation process id.
      operationId: getDataProcessingConsentRevocationRequestById
      security:
        - OAuth2:
            - read
      parameters:
        - name: revocationprocessid
          in: path
          required: true
          schema:
            type: string
            format: uuid
            example: 843ec4b9-34bd-422c-8a6c-40f16c451214
      responses:
        '200':
          description: detailed data of process to revoke a given data processing consent
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DataProcessingConsentRevocationResponse'
        '403':
          description: Forbidden. No further information for security errors.
        '404':
          description: No revocation process found for this revocation process ID
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '../Error/ErrorCatalog.yaml/#/components/schemas/Error'

  /dataprocessingconsenttermsandconditions:
    get:
      summary: Delivers back the terms and conditions in its current version
      tags:
        - Data Processing Consent Terms and Conditions
      description: |
        Delivers back the current version of the terms and conditions for giving a marketing
        consent without personalization and the downloadlinks for the complete text in its representation
        for screen (e.g. as html to be displayed for the consent giving person) and print (e.g. as PDF to download).
      operationId: getDataTermsAndConditions
      security:
          - OAuth2:
            - read
      responses:
        '200':
          description: Marketing consent terms and conditions version and its text representation as a list of documents
          content:
            application/json:
              schema:
               $ref: '#/components/schemas/ConsentTermsAndConditions'
        '403':
          description: Forbidden. No further information for security errors.
        '404':
          description: Ressource not found
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '../Error/ErrorCatalog.yaml/#/components/schemas/Error'


  /marketingconsent:
    post:
      summary: Create a new marketing consent
      tags:
        - Marketing Consent
      description: |
        A new consent to use the personal data for marketing purposes, e.g. to send recommendations for new products,
        will be created.

        - The consent giving person has to be identified upfront and must be refereced by its personId.
        - The version of the marketing consent has to be provided to make sure that the current terms and
          conditions are displayed to the consent giving person. It can be derived when getting the terms and
          conditions via 'get /marketingConsentTermsAndConditions'.
      operationId: createMarketingConsent 
      security:
        - OAuth2:
          - write
      requestBody:
        $ref: '#/components/requestBodies/ConsentRequestBody'
      responses:
        '201':
          description: Marketing consent successfully created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MarketingConsent'
        '400':
          description: Bad request. Usually returned if a required input parameter is missing.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '../Error/ErrorCatalog.yaml/#/components/schemas/Error'
        '403':
          description: Forbidden. No further information for security errors.
        '412':
          description: |
            Precondition Failed. Ususally thrown if an outdated version of the terms and conditions is
            used or the given personId is not valid.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '../Error/ErrorCatalog.yaml/#/components/schemas/Error'


  /marketingconsent/{consentid}:
      get:
        summary: Get details for a marketing consent identified by its consentId
        tags:
          - Marketing Consent
        description:
          Delivers detailed information about a consent to use personal data for marketing purposes,
          identified by the consentId.
        operationId: getMarketingConsentById
        security:
          - OAuth2:
              - read
        parameters:
          - name: consentid
            in: path
            required: true
            schema:
              type: string
              format: uuid
              example: 0e62c4b9-34bd-422c-8a6c-40f16c451214
        responses:
          '200':
            description: Detailed information about a marketing consent
            content:
              application/json:
                schema:
                  $ref: '#/components/schemas/MarketingConsent'
          '403':
            description: Forbidden. No further information for security errors.
          '404':
            description: No consent found for this consent ID
            content:
              application/json:
                schema:
                  type: array
                  items:
                    $ref: '../Error/ErrorCatalog.yaml/#/components/schemas/Error'


  /marketingconsentlist:
    get:
      summary: Get a list of marketing consents of a specific person
      tags:
        - Marketing Consent
      description:
        Delivers a list of consents to use personal data for marketing purposes for a specific person,
        identified by its personId with detailed information about the consents.

        The list can be filtered by the consent status, if no status is given all consents independend if
        its status will be returned.
      operationId: getMarketingConsentListByPersonAndStatus
      security:
          - OAuth2:
            - read
      parameters:
        - name: personId
          in: query
          description: PersonId as UUID of the person who has given the consent
          required: true
          schema:
            type: string
            format: uuid
            example: eb0ddaab-56ff-4cbd-8589-1f2fe219ffdf
        - name: consentStatus
          in: query
          description: Optional state of the consent to filter the list, e.g. receive only consents with state confirmed
          required: false
          schema:
            $ref: '#/components/schemas/ConsentStatus'
      responses:
        '200':
          description: List of marketing consents for a person
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/MarketingConsent'
        '403':
          description: Forbidden. No further information for security errors.
        '404':
          description: No consent found for this person ID
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '../Error/ErrorCatalog.yaml/#/components/schemas/Error'


  /checkmarketingconsent:
    get:
      summary: Check if a specific person has given a valid consent for using its personal data for marketing purposes
      tags:
        - Marketing Consent
      description: |
        Checks if a specific person identified by its personId has given a valid consent for using its personal
        ata for marketing purposes and returns the id of the latest valid consent (if given).
      operationId: checkOnMarketingConsentByPerson
      security:
        - OAuth2:
            - read
      parameters:
        - name: personId
          in: query
          description: PersonId as UUID who has given the consent
          required: true
          schema:
            type: string
            example: eb0ddaab-56ff-4cbd-8589-1f2fe219ffdf
      responses:
        '200':
          description: Marketing consent given
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConsentGiven'
        '403':
          description: Forbidden. No further information for security errors.
        '404':
          description: No person found for this person ID
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '../Error/ErrorCatalog.yaml/#/components/schemas/Error'


  /marketingconsentrevocationrequest:
    post:
      summary: Start a process to revoke a marketing consent identified by its Id
      tags:
        - Marketing Consent Revocation
      description: Starts a process to revoke a consent to use personal data for marketing purposes, identified by its Id.
      operationId: revokeMarketingConsentById
      security:
        - OAuth2:
            - write
      requestBody:
        $ref: '#/components/requestBodies/ConsentRevocationRequestBody'
      responses:
        '200':
          description: process of marketing consent was started
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConsentRevocationResponse'
        '400':
          description: Bad request. Usually returned if a required input parameter is missing.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '../Error/ErrorCatalog.yaml/#/components/schemas/Error'
        '403':
          description: Forbidden. No further information for security errors.
        '404':
          description: No consent found for this consent ID
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '../Error/ErrorCatalog.yaml/#/components/schemas/Error'

  /marketingconsentrevocationrequest/{revocationprocessid}:
    get:
      summary: get the status of a marketing consent revocation process
      tags:
        - Marketing Consent Revocation
      description: Get detailed information including the status of a marketing consent revocation process identified by its revocation process id.
      operationId: getMarketingConsentRevocationRequestById
      security:
        - OAuth2:
            - read
      parameters:
        - name: revocationprocessid
          in: path
          required: true
          schema:
            type: string
            format: uuid
            example: 843ec4b9-34bd-422c-8a6c-40f16c451214
      responses:
        '200':
          description: detailed data of process to revoke a given marketing processing consent
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConsentRevocationResponse'
        '403':
          description: Forbidden. No further information for security errors.
        '404':
          description: No revocation process found for this revocation process ID
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '../Error/ErrorCatalog.yaml/#/components/schemas/Error'


  /marketingconsenttermsandconditions:
    get:
      summary: Delivers back the terms and conditions for marketing consents in its current version
      tags:
        - Marketing Consent Terms and Conditions
      description: Delivers back the current version of the terms and conditions for giving a marketing consent without personalization and the downloadlinks for the complete text in its representation for screen (e.g. as html to be displayed for the consent giving person) and print (e.g. as PDF to download).
      operationId: getMarketingConsentTermsAndConditions
      security:
          - OAuth2:
            - read
      responses:
        '200':
          description: Marketing consent terms and conditions version and its text representation as a list of documents
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConsentTermsAndConditions'
        '403':
          description: Forbidden. No further information for security errors.
        '404':
          description: Ressource not found
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '../Error/ErrorCatalog.yaml/#/components/schemas/Error'

### digital communication consent


  /digitalcommunicationconsent:
    post:
      summary: Create a new digital communication consent
      tags:
        - Digital Communication Consent
      description: A new consent to use the personal data for digital communication purposes, e.g. to send policy related correspondence via email, will be created.<br> 
        <ul><li>The consent giving person has to be identified upfront and must be refereced by its personId.</li>
        <li>The version of the digital communication consent has to be provided to make sure that the current terms and conditions are displayed to the consent giving person. It can be derived when getting the terms and conditions via <i>get /digitalCommunicationConsentTermsAndConditions</i></li>.</ul><br>
      operationId: createDigitalCommunicationConsent 
      security:
        - OAuth2:
          - write
      requestBody:
        $ref: '#/components/requestBodies/ConsentRequestBody'
      responses:
        '201':
          description: Digital communication consent successfully created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DigitalCommunicationConsent'
        '400':
          description: Bad request. Usually returned if a required input parameter is missing.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '../Error/ErrorCatalog.yaml/#/components/schemas/Error'
        '403':
          description: Forbidden. No further information for security errors.
        '412':
          description: Precondition Failed. Ususally thrown if an outdated version of the terms and conditions is used or the given personId is not valid.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '../Error/ErrorCatalog.yaml/#/components/schemas/Error'



  /digitalcommunicationconsent/{consentid}:
      get:
        summary: Get details for a digital communication consent identified by its consentId
        tags:
          - Digital Communication Consent
        description: Delivers detailed information about a consent to use personal data for digital communication purposes, identified by the consentId.
        operationId: getDigitalCommunicationConsentById
        security:
          - OAuth2:
              - read
        parameters:
          - name: consentid
            in: path
            required: true
            schema:
              type: string
              format: uuid
              example: 0e62c4b9-34bd-422c-8a6c-40f16c451214
        responses:
          '200':
            description: Detailed information about a digital communication consent
            content:
              application/json:
                schema:
                  $ref: '#/components/schemas/DigitalCommunicationConsent'
          '403':
            description: Forbidden. No further information for security errors.
          '404':
            description: No consent found for this consent ID
            content:
              application/json:
                schema:
                  type: array
                  items:
                    $ref: '../Error/ErrorCatalog.yaml/#/components/schemas/Error'



  /digitalcommunicationconsentlist:
    get:
      summary: Get a list of digital communication consents of a specific person
      tags:
        - Digital Communication Consent      
      description: |
        Delivers a list of consents to use personal data for digital communication purposes for a specific person,
        identified by its personId with detailed information about the consents.<br>The list can be filtered by the
        consent status, if no status is given all consents independend if its status will be returned.
      operationId: getDigitalCommunicationConsentListByPersonAndStatus
      security:
          - OAuth2:
            - read
      parameters:
        - name: personId
          in: query
          description: PersonId as UUID of the person who has given the consent
          required: true
          schema:
            type: string
            format: uuid
            example: eb0ddaab-56ff-4cbd-8589-1f2fe219ffdf
        - name: consentStatus
          in: query
          description: Optional state of the consent to filter the list, e.g. receive only consents with state confirmed
          required: false
          schema:
            $ref: '#/components/schemas/ConsentStatus'
      responses:
        '200':
          description: List of digital communication consents for a person
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/DigitalCommunicationConsent'
        '403':
          description: Forbidden. No further information for security errors.
        '404':
          description: No consent found for this person ID
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '../Error/ErrorCatalog.yaml/#/components/schemas/Error'

  /checkdigitalcommunicationconsent:
    get:
      summary: |
        Check if a specific person has given a valid consent for using its personal data for digital
        communication purposes
      tags:
        - Digital Communication Consent      
      description: |
        Checks if a specific person identified by its personId has given a valid consent for using its personal data
        for digital communication purposes and returns the id of the latest valid consent (if given).
      operationId: checkOnDigitalCommunicationConsentByPerson
      security:
        - OAuth2:
            - read
      parameters:
        - name: personId
          in: query
          description: PersonId as UUID who has given the consent
          required: true
          schema:
            type: string
            example: eb0ddaab-56ff-4cbd-8589-1f2fe219ffdf
      responses:
        '200':
          description: Digital communication consent given
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConsentGiven'
        '403':
          description: Forbidden. No further information for security errors.
        '404':
          description: No person found for this person ID
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '../Error/ErrorCatalog.yaml/#/components/schemas/Error'

        #400s missing

  /digitalcommunicationconsentrevocationrequest:
    post:
      summary: Start a process to revoke a digital communication consent identified by its Id
      tags:
        - Digital Communication Consent Revocation     
      description: Starts a process to revoke a consent to use personal data for digital communication purposes, identified by its Id.
      operationId: revokeDigitalCommunicationConsentById
      security:
        - OAuth2:
            - write
      requestBody:
        $ref: '#/components/requestBodies/ConsentRevocationRequestBody'
      responses:
        '200':
          description: process of digital communication consent was started
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConsentRevocationResponse'
        '400':
          description: Bad request. Usually returned if a required input parameter is missing.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '../Error/ErrorCatalog.yaml/#/components/schemas/Error'
        '403':
          description: Forbidden. No further information for security errors.
        '404':
          description: No consent found for this consent ID
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '../Error/ErrorCatalog.yaml/#/components/schemas/Error'

  /digitalcommunicationconsentrevocationrequest/{revocationprocessid}:
    get:
      summary: Get the status of a digital communication consent revocation process
      tags:
        - Digital Communication Consent Revocation      
      description: |
        Get detailed information including the status of a digital communication consent revocation process
        identified by its revocation process id.
      operationId: getDigitalCommunicationConsentRevocationRequestById
      security:
        - OAuth2:
            - read
      parameters:
        - name: revocationprocessid
          in: path
          required: true
          schema:
            type: string
            format: uuid
            example: 843ec4b9-34bd-422c-8a6c-40f16c451214
      responses:
        '200':
          description: detailed data of process to revoke the digital communication consent
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConsentRevocationResponse'
        '403':
          description: Forbidden. No further information for security errors.
        '404':
          description: No revocation process found for this revocation process ID
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '../Error/ErrorCatalog.yaml/#/components/schemas/Error'




  /digitalrommunicationconsenttermsandconditions:
    get:
      summary: Delivers back the terms and conditions for digital communication consents in its current version
      tags:
        - Digital Communication Consent Terms and Conditions      
      description: Delivers back the current version of the terms and conditions for giving a digital communication consent without personalization and the downloadlinks for the complete text in its representation for screen (e.g. as html to be displayed for the consent giving person) and print (e.g. as PDF to download).
      operationId: getDigitalCommunicationConsentTermsAndConditions
      security:
          - OAuth2:
            - read
      responses:
        '200':
          description: Digital communication consent terms and conditions version and its text representation as a list of documents
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConsentTermsAndConditions'
        '403':
          description: Forbidden. No further information for security errors.
        '404':
          description: Ressource not found
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '../Error/ErrorCatalog.yaml/#/components/schemas/Error'


components:

#----------------------------
# Security
#----------------------------

  securitySchemes:
    OAuth2:
      type: oauth2
      flows:
        authorizationCode:
          authorizationUrl: https://allianz.com/idp/oauth/authorize
          tokenUrl: https://allianz/idp/oauth/token
          scopes:
            read: Grants read access
            write: Grants write access
            admin: Grants acces to admin operations

#----------------------------
# Request bodies
#----------------------------

  requestBodies:
    ConsentRequestBody:
     description: Request to give consent
     required: true
     content:
       application/json:
         schema:
          $ref: '#/components/schemas/ConsentRequestSchema'

    DataProcessingConsentRequestBody:
     description: Request to give consent
     required: true
     content:
        application/json:
          schema:
            allOf:
              - $ref: '#/components/schemas/ConsentRequestSchema'
            required:
              - externalUsageAllowed
            properties:
              externalUsageAllowed:
                description: Allows the transfer of the personal data to 3rd parties
                type: boolean
                example: true

    DataProcessingRevocationRequestBody:
     description: Request to revoke a given data processing consent by a person
     required: true
     content:
       application/json:
         schema:
           required:
             - consentId
             - revocationScope
           properties:
             consentId:
               description: ID of the consent to be revoked
               type: string
               format: uuid
               example: 0e62c4b9-34bd-422c-8a6c-40f16c451214
             revocationScope:
               description: scope of the data processing consent to be revoked
               type: string
               enum:
                 - allDataProcessingConsents
                 - onlyExternalDataProcessingConsent
               example: allDataProcessingConsents

    ConsentRevocationRequestBody:
     description: Request to revoke a given consent by a person
     required: true
     content:
       application/json:
         schema:
           required:
             - consentId
           properties:
             consentId:
               description: ID of the consent to be revoked
               type: string
               format: uuid
               example: 0e62c4b9-34bd-422c-8a6c-40f16c451214


    
#----------------------------
# Schemas
#----------------------------

  schemas:

#-----------Consent general--------------------
    Consent:
      description: consent given by a person
      type: object
      required:
        - self
        - personId
        - consentStatus
        - consentInitiatedDateTime
        - consentVersion
      properties:
        self:
          description: Unique ID of the according consent
          type: string
          format: uuid
          example: 0e62c4b9-34bd-422c-8a6c-40f16c451214
        personId:
          description: ID of the person of whom the consent was given
          type: string
          format: uuid
          example: eb0ddaab-56ff-4cbd-8589-1f2fe219ffdf
        consentStatus:
          $ref: '#/components/schemas/ConsentStatus'
        consentVersion:
          description: Version of the according paper to which the person gives his/her consent
          type: string
          pattern: ^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)$
          example: 1.0.1
        consentInitiatedDateTime:
          description: Date time when the consent was first requested for
          type: string
          format: date-time
          example: 31-01-2022T10:17+01
        consentGivenDateTime:
          description: Date time when the consent was given
          type: string
          format: dateTime
          example: 31-01-2022T10:17+01
        consentConfirmationRemindedDateTime:
          description: Date time when the person was reminded to confirm his/her consent
          type: string
          format: date-time
          example: 31-01-2022T10:17+01
        consentConfirmationRequestedDateTime:
          description: Date time when a confirmation of the consent was requested
          type: string
          format: dateTime
          example: 31-01-2022T10:17+01
    
    ConsentExt:
      description: data processing consent given by a person
      type: object
      allOf:
        - $ref: '#/components/schemas/Consent'
      properties:
        externalUsageAllowed:
          description: Allows the transfer of the personal data to 3rd parties
          type: boolean
          example: true

    ConsentStatus:
      description: Status of the consent
      type: string
      readOnly: true
      enum:
        - confirmed
        - revoked
        - expired
        - confirmationReminded
        - confirmationTimedout
        - toBeConfirmed
        - rejected
      example: confirmed

    ConsentRequestSchema:
      description: Request to give consent
      type: object
      required:
        - personId
        - dateConsentInitiated
        - consentVersion
        - consentInitiatedDateTime
      properties:
        personId:
          description: ID of the person of whom the consent was given
          type: string
          format: uuid
          example: eb0ddaab-56ff-4cbd-8589-1f2fe219ffdf
        consentVersion:
          description: Version of the according consent definition (wording, terms and conditions) to which the person gives his/her consent
          type: string
          pattern: ^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)$
          example: 1.0.1
        consentInitiatedDateTime:
          description: Date time when the consent was first requested for
          type: string
          format: date-time
          example: 31-01-2022T10:17+01

    ConsentGiven:
      description: Response to check if a person has given a certain consent
      type: object
      required:
        - consentGiven
      properties:
        personId:
          type: string
          format: uuid
          example: 0e62c4b9-34bd-422c-8a6c-40f16c451214
        consentGiven:
          type: boolean
          example: true
        consentId:
          description: consentID of the latest valid marketing consent
          type: string
          format: uuid
          example: 0e62c4b9-34bd-422c-8a6c-40f16c451214

    ConsentRevocationResponse:
      description: Response to a revocation request
      type: object
      properties:
        self:
          description: ID of the revocation request process
          type: string
          format: uuid
          example: 843ec4b9-34bd-422c-8a6c-40f16c451214
        consentId:
          description: Consent ID of the consent to be revoked
          type: string
          format: uuid
          example: 0e62c4b9-34bd-422c-8a6c-40f16c451214
        consentRevokedDateTime:
          description: Date time when the consent was revoked
          type: string
          format: dateTime
          example: 31-01-2022T10:17+01
        ConsentRevocationStatus:
          description: Status of the revocation process
          type: string
          enum:
            - started
            - completed
          example: started

#-----------Data Processing Consent--------------------

    DataProcessingConsent:
      description: data processing consent given by a person
      type: object
      allOf:
        - $ref: '#/components/schemas/ConsentExt'
      properties:
        consentDocuments:
          # description: List of consent documents
          $ref: '#/components/schemas/ConsentDocuments'

    DataProcessingConsentGiven:
      description: Response to check if a person has given a certain consent
      allOf:
        - $ref: '#/components/schemas/ConsentGiven'
      type: object
      required:
        - dataProcessingConsentForExternalUsageGiven
      properties:
        dataProcessingConsentForExternalUsageGiven:
          description: Indicator if the consent includes 3rd party processing
          type: boolean
          example: true

    DataProcessingConsentRevocationResponse:
      description: Response to a revocation request for a data processing consent
      type: object
      allOf:
        - $ref: '#/components/schemas/ConsentRevocationResponse'
      properties:
        ConsentRevocationScope:
          type: string
          enum:
            - allDataProcessingConsents
            - onlyExternalDataProcessingConsent
          example: allDataProcessingConsents

#-----------Marketing Consent--------------------

    MarketingConsent:
      description: marketing consent given by a person
      type: object
      allOf:
        - $ref: '#/components/schemas/Consent'
      properties:
        consentDocuments:
          # description: List of consent documents
          $ref: '#/components/schemas/ConsentDocuments'


#-----------Digital Communication--------------------

    DigitalCommunicationConsent:
      description: marketing consent given by a person
      type: object
      allOf:
        - $ref: '#/components/schemas/Consent'
      properties:
        consentDocuments:
          # description: List of consent documents
          $ref: '#/components/schemas/ConsentDocuments'


#-----------Consent Documents--------------------

    ConsentDocuments:
      description: List of Documents
      type: array
      items:
        type: object
        properties:        
          self:
            description: Unique identifier of the document
            type: string
            format: uuid
            example: 058d89f6-a280-4c10-aef4-e7967464591a
          documentDescription:
            description: Description of the document
            type: string
            minLength: 2
            maxLength: 1024
            example: Id Card of the customer
          documentFileName:
            description: File name of the document
            type: string
            minLength: 5
            maxLength: 255
            pattern: ^[\w,\s-]+\.[A-Za-z]{3}$
            example: sample.pdf
          documentFileType:
            description: Type of the file e.g. PDF
            type: string
            minLength: 2
            maxLength: 3
            pattern: ^[A-Za-z]{3}$
            example: PDF
          mimeType:
            description: Mime type of the attached document
            type: string
            enum:
              - application/msword
              - application/pdf
              - image/gif
              - image/jpeg
              - image/png
              - image/tiff
              - text/plain
              - video/mp4
              - video/mpeg
            example: application/pdf
          documentFile:
            description: Attached document according to mime type Base64 encoded
            type: string

#-----------Consent Terms and Conditions--------------------

    ConsentTermsAndConditions:
      description: Consent terms and conditions version and its text representation as a list of documents
      type: object
      required:
        - consentVersion
      properties:        
        consentVersion:
          type: string
          example: 1.0.1
        termsAndConditionsScreenRepresentation:
          type: object
          properties:
            url:
              type: string
              format: uri
              example: 'https://www.allianz.com/prospect/5081a4bf-3378-4644-886e-59a7a2c386f1'
            mimeType:
              description: Mime type of the document with terms and conditions for screen
              type: string
              enum:
                - text/plain
                - text/html
              example: text/html
        termsAndConditionsPrintRepresentation:
          type: object
          properties:
            url:
              type: string
              format: uri
              example: 'https://www.allianz.com/prospect/5081a4bf-3378-4644-886e-59a7a2c386f1'
            mimeType:
              description: Mime type of the document with terms and conditions for print 
              type: string
              enum:
                - application/pdf
                - image/jpeg
                - image/png
                - image/tiff
              example: application/pdf
